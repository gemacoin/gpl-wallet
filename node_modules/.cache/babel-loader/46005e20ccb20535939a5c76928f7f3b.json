{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useReferral = exports.useCanSwap = exports.useSwapFair = exports.useSwapContext = exports.SwapContextProvider = void 0;\n\nvar jsx_runtime_1 = require(\"react/jsx-runtime\");\n\nvar assert = __importStar(require(\"assert\"));\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar react_async_hook_1 = require(\"react-async-hook\");\n\nvar spl_token_1 = require(\"@solana/spl-token\");\n\nvar pubkeys_1 = require(\"../utils/pubkeys\");\n\nvar Dex_1 = require(\"./Dex\");\n\nvar TokenList_1 = require(\"./TokenList\");\n\nvar Token_1 = require(\"../context/Token\");\n\nvar DEFAULT_SLIPPAGE_PERCENT = 0.5;\n\nvar _SwapContext = react_1.default.createContext(null);\n\nfunction SwapContextProvider(props) {\n  var _a, _b, _c, _d;\n\n  var _e = (0, react_1.useState)((_a = props.fromMint) !== null && _a !== void 0 ? _a : pubkeys_1.SRM_MINT),\n      fromMint = _e[0],\n      setFromMint = _e[1];\n\n  var _f = (0, react_1.useState)((_b = props.toMint) !== null && _b !== void 0 ? _b : pubkeys_1.USDC_MINT),\n      toMint = _f[0],\n      setToMint = _f[1];\n\n  var _g = (0, react_1.useState)((_c = props.fromAmount) !== null && _c !== void 0 ? _c : 0),\n      fromAmount = _g[0],\n      _setFromAmount = _g[1];\n\n  var _h = (0, react_1.useState)((_d = props.toAmount) !== null && _d !== void 0 ? _d : 0),\n      toAmount = _h[0],\n      _setToAmount = _h[1];\n\n  var _j = (0, react_1.useState)(false),\n      isClosingNewAccounts = _j[0],\n      setIsClosingNewAccounts = _j[1];\n\n  var _k = (0, react_1.useState)(false),\n      isStrict = _k[0],\n      setIsStrict = _k[1];\n\n  var _l = (0, react_1.useState)(DEFAULT_SLIPPAGE_PERCENT),\n      slippage = _l[0],\n      setSlippage = _l[1];\n\n  var _m = (0, react_1.useState)(null),\n      fairOverride = _m[0],\n      setFairOverride = _m[1];\n\n  var fair = _useSwapFair(fromMint, toMint, fairOverride);\n\n  var referral = props.referral;\n  assert.ok(slippage >= 0);\n  (0, react_1.useEffect)(function () {\n    if (!fair) {\n      return;\n    }\n\n    setFromAmount(fromAmount);\n  }, [fair]);\n\n  var swapToFromMints = function () {\n    var oldFrom = fromMint;\n    var oldTo = toMint;\n    var oldToAmount = toAmount;\n\n    _setFromAmount(oldToAmount);\n\n    setFromMint(oldTo);\n    setToMint(oldFrom);\n  };\n\n  var setFromAmount = function (amount) {\n    if (fair === undefined) {\n      _setFromAmount(0);\n\n      _setToAmount(0);\n\n      return;\n    }\n\n    _setFromAmount(amount);\n\n    _setToAmount(Dex_1.FEE_MULTIPLIER * (amount / fair));\n  };\n\n  var setToAmount = function (amount) {\n    if (fair === undefined) {\n      _setFromAmount(0);\n\n      _setToAmount(0);\n\n      return;\n    }\n\n    _setToAmount(amount);\n\n    _setFromAmount(amount * fair / Dex_1.FEE_MULTIPLIER);\n  };\n\n  return (0, jsx_runtime_1.jsx)(_SwapContext.Provider, __assign({\n    value: {\n      fromMint: fromMint,\n      setFromMint: setFromMint,\n      toMint: toMint,\n      setToMint: setToMint,\n      fromAmount: fromAmount,\n      setFromAmount: setFromAmount,\n      toAmount: toAmount,\n      setToAmount: setToAmount,\n      swapToFromMints: swapToFromMints,\n      slippage: slippage,\n      setSlippage: setSlippage,\n      fairOverride: fairOverride,\n      setFairOverride: setFairOverride,\n      isClosingNewAccounts: isClosingNewAccounts,\n      isStrict: isStrict,\n      setIsStrict: setIsStrict,\n      setIsClosingNewAccounts: setIsClosingNewAccounts,\n      referral: referral\n    }\n  }, {\n    children: props.children\n  }), void 0);\n}\n\nexports.SwapContextProvider = SwapContextProvider;\n\nfunction useSwapContext() {\n  var ctx = (0, react_1.useContext)(_SwapContext);\n\n  if (ctx === null) {\n    throw new Error(\"Context not available\");\n  }\n\n  return ctx;\n}\n\nexports.useSwapContext = useSwapContext;\n\nfunction useSwapFair() {\n  var _a = useSwapContext(),\n      fairOverride = _a.fairOverride,\n      fromMint = _a.fromMint,\n      toMint = _a.toMint;\n\n  return _useSwapFair(fromMint, toMint, fairOverride);\n}\n\nexports.useSwapFair = useSwapFair;\n\nfunction _useSwapFair(fromMint, toMint, fairOverride) {\n  var fairRoute = (0, Dex_1.useFairRoute)(fromMint, toMint);\n  var fair = fairOverride === null ? fairRoute : fairOverride;\n  return fair;\n} // Returns true if the user can swap with the current context.\n\n\nfunction useCanSwap() {\n  var _a, _b, _c, _d;\n\n  var _e = useSwapContext(),\n      fromMint = _e.fromMint,\n      toMint = _e.toMint,\n      fromAmount = _e.fromAmount,\n      toAmount = _e.toAmount;\n\n  var swapClient = (0, Dex_1.useDexContext)().swapClient;\n\n  var _f = (0, TokenList_1.useTokenListContext)(),\n      wormholeMap = _f.wormholeMap,\n      solletMap = _f.solletMap;\n\n  var fromWallet = (0, Token_1.useOwnedTokenAccount)(fromMint);\n  var fair = useSwapFair();\n  var route = (0, Dex_1.useRouteVerbose)(fromMint, toMint);\n\n  if (route === null) {\n    return false;\n  }\n\n  return (// From wallet exists.\n    fromWallet !== undefined && fromWallet !== null && // Fair price is defined.\n    fair !== undefined && fair > 0 && // Mints are distinct.\n    fromMint.equals(toMint) === false && // Wallet is connected.\n    swapClient.program.provider.wallet.publicKey !== null && // Trade amounts greater than zero.\n    fromAmount > 0 && toAmount > 0 && // Trade route exists.\n    route !== null && ( // Wormhole <-> native markets must have the wormhole token as the\n    // *from* address since they're one-sided markets.\n    route.kind !== \"wormhole-native\" || ((_b = (_a = wormholeMap.get(fromMint.toString())) === null || _a === void 0 ? void 0 : _a.tags) === null || _b === void 0 ? void 0 : _b.includes(TokenList_1.SPL_REGISTRY_WORM_TAG)) !== undefined) && ( // Wormhole <-> sollet markets must have the sollet token as the\n    // *from* address since they're one sided markets.\n    route.kind !== \"wormhole-sollet\" || ((_d = (_c = solletMap.get(fromMint.toString())) === null || _c === void 0 ? void 0 : _c.tags) === null || _d === void 0 ? void 0 : _d.includes(TokenList_1.SPL_REGISTRY_SOLLET_TAG)) !== undefined)\n  );\n}\n\nexports.useCanSwap = useCanSwap;\n\nfunction useReferral(fromMarket) {\n  var _this = this;\n\n  var referral = useSwapContext().referral;\n  var asyncReferral = (0, react_async_hook_1.useAsync)(function () {\n    return __awaiter(_this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!referral) {\n          return [2\n          /*return*/\n          , undefined];\n        }\n\n        if (!fromMarket) {\n          return [2\n          /*return*/\n          , undefined];\n        }\n\n        if (!fromMarket.quoteMintAddress.equals(pubkeys_1.USDC_MINT) && !fromMarket.quoteMintAddress.equals(pubkeys_1.USDT_MINT)) {\n          return [2\n          /*return*/\n          , undefined];\n        }\n\n        return [2\n        /*return*/\n        , spl_token_1.Token.getAssociatedTokenAddress(spl_token_1.ASSOCIATED_TOKEN_PROGRAM_ID, spl_token_1.TOKEN_PROGRAM_ID, fromMarket.quoteMintAddress, referral)];\n      });\n    });\n  }, [fromMarket]);\n\n  if (!asyncReferral.result) {\n    return undefined;\n  }\n\n  return asyncReferral.result;\n}\n\nexports.useReferral = useReferral;","map":{"version":3,"sources":["/home/imentus/spl-token-wallet/node_modules/@project-serum/swap-ui/dist/context/Swap.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__createBinding","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","op","TypeError","pop","push","exports","useReferral","useCanSwap","useSwapFair","useSwapContext","SwapContextProvider","jsx_runtime_1","require","assert","react_1","react_async_hook_1","spl_token_1","pubkeys_1","Dex_1","TokenList_1","Token_1","DEFAULT_SLIPPAGE_PERCENT","_SwapContext","default","createContext","props","_a","_b","_c","_d","_e","useState","fromMint","SRM_MINT","setFromMint","_f","toMint","USDC_MINT","setToMint","_g","fromAmount","_setFromAmount","_h","toAmount","_setToAmount","_j","isClosingNewAccounts","setIsClosingNewAccounts","_k","isStrict","setIsStrict","_l","slippage","setSlippage","_m","fairOverride","setFairOverride","fair","_useSwapFair","referral","ok","useEffect","setFromAmount","swapToFromMints","oldFrom","oldTo","oldToAmount","amount","FEE_MULTIPLIER","setToAmount","jsx","Provider","children","ctx","useContext","Error","fairRoute","useFairRoute","swapClient","useDexContext","useTokenListContext","wormholeMap","solletMap","fromWallet","useOwnedTokenAccount","route","useRouteVerbose","equals","program","provider","wallet","publicKey","kind","toString","tags","includes","SPL_REGISTRY_WORM_TAG","SPL_REGISTRY_SOLLET_TAG","fromMarket","_this","asyncReferral","useAsync","quoteMintAddress","USDT_MINT","Token","getAssociatedTokenAddress","ASSOCIATED_TOKEN_PROGRAM_ID","TOKEN_PROGRAM_ID"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useReferral = exports.useCanSwap = exports.useSwapFair = exports.useSwapContext = exports.SwapContextProvider = void 0;\nvar jsx_runtime_1 = require(\"react/jsx-runtime\");\nvar assert = __importStar(require(\"assert\"));\nvar react_1 = __importStar(require(\"react\"));\nvar react_async_hook_1 = require(\"react-async-hook\");\nvar spl_token_1 = require(\"@solana/spl-token\");\nvar pubkeys_1 = require(\"../utils/pubkeys\");\nvar Dex_1 = require(\"./Dex\");\nvar TokenList_1 = require(\"./TokenList\");\nvar Token_1 = require(\"../context/Token\");\nvar DEFAULT_SLIPPAGE_PERCENT = 0.5;\nvar _SwapContext = react_1.default.createContext(null);\nfunction SwapContextProvider(props) {\n    var _a, _b, _c, _d;\n    var _e = (0, react_1.useState)((_a = props.fromMint) !== null && _a !== void 0 ? _a : pubkeys_1.SRM_MINT), fromMint = _e[0], setFromMint = _e[1];\n    var _f = (0, react_1.useState)((_b = props.toMint) !== null && _b !== void 0 ? _b : pubkeys_1.USDC_MINT), toMint = _f[0], setToMint = _f[1];\n    var _g = (0, react_1.useState)((_c = props.fromAmount) !== null && _c !== void 0 ? _c : 0), fromAmount = _g[0], _setFromAmount = _g[1];\n    var _h = (0, react_1.useState)((_d = props.toAmount) !== null && _d !== void 0 ? _d : 0), toAmount = _h[0], _setToAmount = _h[1];\n    var _j = (0, react_1.useState)(false), isClosingNewAccounts = _j[0], setIsClosingNewAccounts = _j[1];\n    var _k = (0, react_1.useState)(false), isStrict = _k[0], setIsStrict = _k[1];\n    var _l = (0, react_1.useState)(DEFAULT_SLIPPAGE_PERCENT), slippage = _l[0], setSlippage = _l[1];\n    var _m = (0, react_1.useState)(null), fairOverride = _m[0], setFairOverride = _m[1];\n    var fair = _useSwapFair(fromMint, toMint, fairOverride);\n    var referral = props.referral;\n    assert.ok(slippage >= 0);\n    (0, react_1.useEffect)(function () {\n        if (!fair) {\n            return;\n        }\n        setFromAmount(fromAmount);\n    }, [fair]);\n    var swapToFromMints = function () {\n        var oldFrom = fromMint;\n        var oldTo = toMint;\n        var oldToAmount = toAmount;\n        _setFromAmount(oldToAmount);\n        setFromMint(oldTo);\n        setToMint(oldFrom);\n    };\n    var setFromAmount = function (amount) {\n        if (fair === undefined) {\n            _setFromAmount(0);\n            _setToAmount(0);\n            return;\n        }\n        _setFromAmount(amount);\n        _setToAmount(Dex_1.FEE_MULTIPLIER * (amount / fair));\n    };\n    var setToAmount = function (amount) {\n        if (fair === undefined) {\n            _setFromAmount(0);\n            _setToAmount(0);\n            return;\n        }\n        _setToAmount(amount);\n        _setFromAmount((amount * fair) / Dex_1.FEE_MULTIPLIER);\n    };\n    return ((0, jsx_runtime_1.jsx)(_SwapContext.Provider, __assign({ value: {\n            fromMint: fromMint,\n            setFromMint: setFromMint,\n            toMint: toMint,\n            setToMint: setToMint,\n            fromAmount: fromAmount,\n            setFromAmount: setFromAmount,\n            toAmount: toAmount,\n            setToAmount: setToAmount,\n            swapToFromMints: swapToFromMints,\n            slippage: slippage,\n            setSlippage: setSlippage,\n            fairOverride: fairOverride,\n            setFairOverride: setFairOverride,\n            isClosingNewAccounts: isClosingNewAccounts,\n            isStrict: isStrict,\n            setIsStrict: setIsStrict,\n            setIsClosingNewAccounts: setIsClosingNewAccounts,\n            referral: referral,\n        } }, { children: props.children }), void 0));\n}\nexports.SwapContextProvider = SwapContextProvider;\nfunction useSwapContext() {\n    var ctx = (0, react_1.useContext)(_SwapContext);\n    if (ctx === null) {\n        throw new Error(\"Context not available\");\n    }\n    return ctx;\n}\nexports.useSwapContext = useSwapContext;\nfunction useSwapFair() {\n    var _a = useSwapContext(), fairOverride = _a.fairOverride, fromMint = _a.fromMint, toMint = _a.toMint;\n    return _useSwapFair(fromMint, toMint, fairOverride);\n}\nexports.useSwapFair = useSwapFair;\nfunction _useSwapFair(fromMint, toMint, fairOverride) {\n    var fairRoute = (0, Dex_1.useFairRoute)(fromMint, toMint);\n    var fair = fairOverride === null ? fairRoute : fairOverride;\n    return fair;\n}\n// Returns true if the user can swap with the current context.\nfunction useCanSwap() {\n    var _a, _b, _c, _d;\n    var _e = useSwapContext(), fromMint = _e.fromMint, toMint = _e.toMint, fromAmount = _e.fromAmount, toAmount = _e.toAmount;\n    var swapClient = (0, Dex_1.useDexContext)().swapClient;\n    var _f = (0, TokenList_1.useTokenListContext)(), wormholeMap = _f.wormholeMap, solletMap = _f.solletMap;\n    var fromWallet = (0, Token_1.useOwnedTokenAccount)(fromMint);\n    var fair = useSwapFair();\n    var route = (0, Dex_1.useRouteVerbose)(fromMint, toMint);\n    if (route === null) {\n        return false;\n    }\n    return (\n    // From wallet exists.\n    fromWallet !== undefined &&\n        fromWallet !== null &&\n        // Fair price is defined.\n        fair !== undefined &&\n        fair > 0 &&\n        // Mints are distinct.\n        fromMint.equals(toMint) === false &&\n        // Wallet is connected.\n        swapClient.program.provider.wallet.publicKey !== null &&\n        // Trade amounts greater than zero.\n        fromAmount > 0 &&\n        toAmount > 0 &&\n        // Trade route exists.\n        route !== null &&\n        // Wormhole <-> native markets must have the wormhole token as the\n        // *from* address since they're one-sided markets.\n        (route.kind !== \"wormhole-native\" ||\n            ((_b = (_a = wormholeMap\n                .get(fromMint.toString())) === null || _a === void 0 ? void 0 : _a.tags) === null || _b === void 0 ? void 0 : _b.includes(TokenList_1.SPL_REGISTRY_WORM_TAG)) !== undefined) &&\n        // Wormhole <-> sollet markets must have the sollet token as the\n        // *from* address since they're one sided markets.\n        (route.kind !== \"wormhole-sollet\" ||\n            ((_d = (_c = solletMap\n                .get(fromMint.toString())) === null || _c === void 0 ? void 0 : _c.tags) === null || _d === void 0 ? void 0 : _d.includes(TokenList_1.SPL_REGISTRY_SOLLET_TAG)) !== undefined));\n}\nexports.useCanSwap = useCanSwap;\nfunction useReferral(fromMarket) {\n    var _this = this;\n    var referral = useSwapContext().referral;\n    var asyncReferral = (0, react_async_hook_1.useAsync)(function () { return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (!referral) {\n                return [2 /*return*/, undefined];\n            }\n            if (!fromMarket) {\n                return [2 /*return*/, undefined];\n            }\n            if (!fromMarket.quoteMintAddress.equals(pubkeys_1.USDC_MINT) &&\n                !fromMarket.quoteMintAddress.equals(pubkeys_1.USDT_MINT)) {\n                return [2 /*return*/, undefined];\n            }\n            return [2 /*return*/, spl_token_1.Token.getAssociatedTokenAddress(spl_token_1.ASSOCIATED_TOKEN_PROGRAM_ID, spl_token_1.TOKEN_PROGRAM_ID, fromMarket.quoteMintAddress, referral)];\n        });\n    }); }, [fromMarket]);\n    if (!asyncReferral.result) {\n        return undefined;\n    }\n    return asyncReferral.result;\n}\nexports.useReferral = useReferral;\n"]},"metadata":{},"sourceType":"script"}
{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useRouteVerbose = exports.useRoute = exports.useFairRoute = exports.useBbo = exports.useMarketName = exports.useOrderbook = exports.useMarket = exports.useOpenOrders = exports.useDexContext = exports.DexContextProvider = exports.FEE_MULTIPLIER = void 0;\n\nvar jsx_runtime_1 = require(\"react/jsx-runtime\");\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar assert = __importStar(require(\"assert\"));\n\nvar react_async_hook_1 = require(\"react-async-hook\");\n\nvar spl_token_1 = require(\"@solana/spl-token\");\n\nvar web3_js_1 = require(\"@solana/web3.js\");\n\nvar anchor = __importStar(require(\"@project-serum/anchor\"));\n\nvar serum_1 = require(\"@project-serum/serum\");\n\nvar pubkeys_1 = require(\"../utils/pubkeys\");\n\nvar TokenList_1 = require(\"./TokenList\");\n\nvar Sollet_1 = require(\"./Sollet\");\n\nvar Token_1 = require(\"./Token\");\n\nvar BASE_TAKER_FEE_BPS = 0.0022;\nexports.FEE_MULTIPLIER = 1 - BASE_TAKER_FEE_BPS;\n\nvar _DexContext = react_1.default.createContext(null);\n\nfunction DexContextProvider(props) {\n  var _this = this;\n\n  var _a = (0, react_1.useState)(new Map()),\n      ooAccounts = _a[0],\n      setOoAccounts = _a[1];\n\n  var swapClient = props.swapClient; // Removes the given open orders from the context.\n\n  var closeOpenOrders = function (openOrder) {\n    return __awaiter(_this, void 0, void 0, function () {\n      var newOoAccounts, openOrders;\n\n      var _a;\n\n      return __generator(this, function (_b) {\n        newOoAccounts = new Map(ooAccounts);\n        openOrders = (_a = newOoAccounts.get(openOrder.market.toString())) === null || _a === void 0 ? void 0 : _a.filter(function (oo) {\n          return !oo.address.equals(openOrder.address);\n        });\n\n        if (openOrders && openOrders.length > 0) {\n          newOoAccounts.set(openOrder.market.toString(), openOrders);\n        } else {\n          newOoAccounts.delete(openOrder.market.toString());\n        }\n\n        setOoAccounts(newOoAccounts);\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  }; // Three operations:\n  //\n  // 1. Fetch all open orders accounts for the connected wallet.\n  // 2. Batch fetch all market accounts for those open orders.\n  // 3. Batch fetch all mints associated with the markets.\n\n\n  (0, react_1.useEffect)(function () {\n    if (!swapClient.program.provider.wallet.publicKey) {\n      setOoAccounts(new Map());\n      return;\n    }\n\n    serum_1.OpenOrders.findForOwner(swapClient.program.provider.connection, swapClient.program.provider.wallet.publicKey, pubkeys_1.DEX_PID).then(function (openOrders) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var newOoAccounts, markets, multipleMarkets, marketClients, mintPubkeys, mints, mintInfos;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              newOoAccounts = new Map();\n              markets = new Set();\n              openOrders.forEach(function (oo) {\n                markets.add(oo.market.toString());\n\n                if (newOoAccounts.get(oo.market.toString())) {\n                  newOoAccounts.get(oo.market.toString()).push(oo);\n                } else {\n                  newOoAccounts.set(oo.market.toString(), [oo]);\n                }\n              });\n\n              if (markets.size > 100) {\n                // Punt request chunking until there's user demand.\n                throw new Error(\"Too many markets. Please file an issue to update this\");\n              }\n\n              return [4\n              /*yield*/\n              , anchor.utils.rpc.getMultipleAccounts(swapClient.program.provider.connection, Array.from(markets.values()).map(function (m) {\n                return new web3_js_1.PublicKey(m);\n              }))];\n\n            case 1:\n              multipleMarkets = _a.sent();\n              marketClients = multipleMarkets.map(function (programAccount) {\n                return {\n                  publicKey: programAccount === null || programAccount === void 0 ? void 0 : programAccount.publicKey,\n                  account: new serum_1.Market(serum_1.Market.getLayout(pubkeys_1.DEX_PID).decode(programAccount === null || programAccount === void 0 ? void 0 : programAccount.account.data), -1, // Set below so that we can batch fetch mints.\n                  -1, // Set below so that we can batch fetch mints.\n                  swapClient.program.provider.opts, pubkeys_1.DEX_PID)\n                };\n              });\n              setOoAccounts(newOoAccounts);\n              mintPubkeys = Array.from(new Set(marketClients.map(function (m) {\n                return [m.account.baseMintAddress.toString(), m.account.quoteMintAddress.toString()];\n              }).flat()).values()).map(function (pk) {\n                return new web3_js_1.PublicKey(pk);\n              });\n\n              if (mintPubkeys.length > 100) {\n                // Punt request chunking until there's user demand.\n                throw new Error(\"Too many mints. Please file an issue to update this\");\n              }\n\n              return [4\n              /*yield*/\n              , anchor.utils.rpc.getMultipleAccounts(swapClient.program.provider.connection, mintPubkeys)];\n\n            case 2:\n              mints = _a.sent();\n              mintInfos = mints.map(function (mint) {\n                var mintInfo = spl_token_1.MintLayout.decode(mint.account.data);\n                (0, Token_1.setMintCache)(mint.publicKey, mintInfo);\n                return {\n                  publicKey: mint.publicKey,\n                  mintInfo: mintInfo\n                };\n              });\n              marketClients.forEach(function (m) {\n                var baseMintInfo = mintInfos.filter(function (mint) {\n                  return mint.publicKey.equals(m.account.baseMintAddress);\n                })[0];\n                var quoteMintInfo = mintInfos.filter(function (mint) {\n                  return mint.publicKey.equals(m.account.quoteMintAddress);\n                })[0];\n                assert.ok(baseMintInfo && quoteMintInfo); // @ts-ignore\n\n                m.account._baseSplTokenDecimals = baseMintInfo.mintInfo.decimals; // @ts-ignore\n\n                m.account._quoteSplTokenDecimals = quoteMintInfo.mintInfo.decimals;\n\n                _MARKET_CACHE.set(m.publicKey.toString(), new Promise(function (resolve) {\n                  return resolve(m.account);\n                }));\n              });\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    });\n  }, [swapClient.program.provider.connection, swapClient.program.provider.wallet.publicKey, swapClient.program.provider.opts]);\n  return (0, jsx_runtime_1.jsx)(_DexContext.Provider, __assign({\n    value: {\n      openOrders: ooAccounts,\n      closeOpenOrders: closeOpenOrders,\n      swapClient: swapClient\n    }\n  }, {\n    children: props.children\n  }), void 0);\n}\n\nexports.DexContextProvider = DexContextProvider;\n\nfunction useDexContext() {\n  var ctx = (0, react_1.useContext)(_DexContext);\n\n  if (ctx === null) {\n    throw new Error(\"Context not available\");\n  }\n\n  return ctx;\n}\n\nexports.useDexContext = useDexContext;\n\nfunction useOpenOrders() {\n  var ctx = useDexContext();\n  return ctx.openOrders;\n}\n\nexports.useOpenOrders = useOpenOrders; // Lazy load a given market.\n\nfunction useMarket(market) {\n  var _this = this;\n\n  var swapClient = useDexContext().swapClient;\n  var asyncMarket = (0, react_async_hook_1.useAsync)(function () {\n    return __awaiter(_this, void 0, void 0, function () {\n      var marketClient;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        if (!market) {\n          return [2\n          /*return*/\n          , undefined];\n        }\n\n        if (_MARKET_CACHE.get(market.toString())) {\n          return [2\n          /*return*/\n          , _MARKET_CACHE.get(market.toString())];\n        }\n\n        marketClient = new Promise(function (resolve) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var marketClient;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  return [4\n                  /*yield*/\n                  , serum_1.Market.load(swapClient.program.provider.connection, market, swapClient.program.provider.opts, pubkeys_1.DEX_PID)];\n\n                case 1:\n                  marketClient = _a.sent();\n                  resolve(marketClient);\n                  return [2\n                  /*return*/\n                  ];\n              }\n            });\n          });\n        });\n\n        _MARKET_CACHE.set(market.toString(), marketClient);\n\n        return [2\n        /*return*/\n        , marketClient];\n      });\n    });\n  }, [swapClient.program.provider.connection, market]);\n\n  if (asyncMarket.result) {\n    return asyncMarket.result;\n  }\n\n  return undefined;\n}\n\nexports.useMarket = useMarket; // Lazy load the orderbook for a given market.\n\nfunction useOrderbook(market) {\n  var _this = this;\n\n  var swapClient = useDexContext().swapClient;\n  var marketClient = useMarket(market);\n\n  var _a = (0, react_1.useState)(0),\n      refresh = _a[0],\n      setRefresh = _a[1];\n\n  var asyncOrderbook = (0, react_async_hook_1.useAsync)(function () {\n    return __awaiter(_this, void 0, void 0, function () {\n      var orderbook;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        if (!market || !marketClient) {\n          return [2\n          /*return*/\n          , undefined];\n        }\n\n        if (_ORDERBOOK_CACHE.get(market.toString())) {\n          return [2\n          /*return*/\n          , _ORDERBOOK_CACHE.get(market.toString())];\n        }\n\n        orderbook = new Promise(function (resolve) {\n          return __awaiter(_this, void 0, void 0, function () {\n            var _a, bids, asks;\n\n            return __generator(this, function (_b) {\n              switch (_b.label) {\n                case 0:\n                  return [4\n                  /*yield*/\n                  , Promise.all([marketClient.loadBids(swapClient.program.provider.connection), marketClient.loadAsks(swapClient.program.provider.connection)])];\n\n                case 1:\n                  _a = _b.sent(), bids = _a[0], asks = _a[1];\n                  resolve({\n                    bids: bids,\n                    asks: asks\n                  });\n                  return [2\n                  /*return*/\n                  ];\n              }\n            });\n          });\n        });\n\n        _ORDERBOOK_CACHE.set(market.toString(), orderbook);\n\n        return [2\n        /*return*/\n        , orderbook];\n      });\n    });\n  }, [refresh, swapClient.program.provider.connection, market, marketClient]); // Stream in bids updates.\n\n  (0, react_1.useEffect)(function () {\n    var listener;\n\n    if (marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress) {\n      listener = swapClient.program.provider.connection.onAccountChange(marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress, function (info) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var bids, orderbook, oldBestBid, newBestBid;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                bids = serum_1.Orderbook.decode(marketClient, info.data);\n                return [4\n                /*yield*/\n                , _ORDERBOOK_CACHE.get(marketClient.address.toString())];\n\n              case 1:\n                orderbook = _a.sent();\n                oldBestBid = orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids.items(true).next().value;\n                newBestBid = bids.items(true).next().value;\n\n                if (orderbook && oldBestBid && newBestBid && oldBestBid.price !== newBestBid.price) {\n                  orderbook.bids = bids;\n                  setRefresh(function (r) {\n                    return r + 1;\n                  });\n                }\n\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      });\n    }\n\n    return function () {\n      if (listener) {\n        swapClient.program.provider.connection.removeAccountChangeListener(listener);\n      }\n    };\n  }, [marketClient, marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress, swapClient.program.provider.connection]); // Stream in asks updates.\n\n  (0, react_1.useEffect)(function () {\n    var listener;\n\n    if (marketClient === null || marketClient === void 0 ? void 0 : marketClient.asksAddress) {\n      listener = swapClient.program.provider.connection.onAccountChange(marketClient === null || marketClient === void 0 ? void 0 : marketClient.asksAddress, function (info) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var asks, orderbook, oldBestOffer, newBestOffer;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                asks = serum_1.Orderbook.decode(marketClient, info.data);\n                return [4\n                /*yield*/\n                , _ORDERBOOK_CACHE.get(marketClient.address.toString())];\n\n              case 1:\n                orderbook = _a.sent();\n                oldBestOffer = orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks.items(false).next().value;\n                newBestOffer = asks.items(false).next().value;\n\n                if (orderbook && oldBestOffer && newBestOffer && oldBestOffer.price !== newBestOffer.price) {\n                  orderbook.asks = asks;\n                  setRefresh(function (r) {\n                    return r + 1;\n                  });\n                }\n\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      });\n    }\n\n    return function () {\n      if (listener) {\n        swapClient.program.provider.connection.removeAccountChangeListener(listener);\n      }\n    };\n  }, [marketClient, marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress, swapClient.program.provider.connection]);\n\n  if (asyncOrderbook.result) {\n    return asyncOrderbook.result;\n  }\n\n  return undefined;\n}\n\nexports.useOrderbook = useOrderbook;\n\nfunction useMarketName(market) {\n  var _a, _b;\n\n  var tokenMap = (0, TokenList_1.useTokenMap)();\n  var marketClient = useMarket(market);\n\n  if (!marketClient) {\n    return null;\n  }\n\n  var baseTicker = marketClient ? (_a = tokenMap.get(marketClient === null || marketClient === void 0 ? void 0 : marketClient.baseMintAddress.toString())) === null || _a === void 0 ? void 0 : _a.symbol : \"-\";\n  var quoteTicker = marketClient ? (_b = tokenMap.get(marketClient === null || marketClient === void 0 ? void 0 : marketClient.quoteMintAddress.toString())) === null || _b === void 0 ? void 0 : _b.symbol : \"-\";\n  var name = baseTicker + \" / \" + quoteTicker;\n  return name;\n}\n\nexports.useMarketName = useMarketName; // Fair price for a given market, as defined by the mid.\n\nfunction useBbo(market) {\n  var orderbook = useOrderbook(market);\n\n  if (orderbook === undefined) {\n    return undefined;\n  }\n\n  var bestBid = orderbook.bids.items(true).next().value;\n  var bestOffer = orderbook.asks.items(false).next().value;\n\n  if (!bestBid && !bestOffer) {\n    return {};\n  }\n\n  if (!bestBid) {\n    return {\n      bestOffer: bestOffer.price\n    };\n  }\n\n  if (!bestOffer) {\n    return {\n      bestBid: bestBid.price\n    };\n  }\n\n  var mid = (bestBid.price + bestOffer.price) / 2.0;\n  return {\n    bestBid: bestBid.price,\n    bestOffer: bestOffer.price,\n    mid: mid\n  };\n}\n\nexports.useBbo = useBbo; // Fair price for a theoretical toMint/fromMint market. I.e., the number\n// of `fromMint` tokens to purchase a single `toMint` token. Aggregates\n// across a trade route, if needed.\n\nfunction useFairRoute(fromMint, toMint) {\n  var route = useRoute(fromMint, toMint);\n  var fromBbo = useBbo(route ? route[0] : undefined);\n  var fromMarket = useMarket(route ? route[0] : undefined);\n  var toBbo = useBbo(route ? route[1] : undefined);\n\n  if (route === null) {\n    return undefined;\n  }\n\n  if (route.length === 1 && fromBbo !== undefined) {\n    if (fromMarket === undefined) {\n      return undefined;\n    }\n\n    if ((fromMarket === null || fromMarket === void 0 ? void 0 : fromMarket.baseMintAddress.equals(fromMint)) || (fromMarket === null || fromMarket === void 0 ? void 0 : fromMarket.baseMintAddress.equals(pubkeys_1.WRAPPED_GEMA_MINT)) && fromMint.equals(pubkeys_1.SOL_MINT)) {\n      return fromBbo.bestBid && 1.0 / fromBbo.bestBid;\n    } else {\n      return fromBbo.bestOffer && fromBbo.bestOffer;\n    }\n  }\n\n  if (fromBbo === undefined || fromBbo.bestBid === undefined || toBbo === undefined || toBbo.bestOffer === undefined) {\n    return undefined;\n  }\n\n  return toBbo.bestOffer / fromBbo.bestBid;\n}\n\nexports.useFairRoute = useFairRoute;\n\nfunction useRoute(fromMint, toMint) {\n  var route = useRouteVerbose(fromMint, toMint);\n\n  if (route === null) {\n    return null;\n  }\n\n  return route.markets;\n}\n\nexports.useRoute = useRoute; // Types of routes.\n//\n// 1. Direct trades on USDC quoted markets.\n// 2. Transitive trades across two USDC qutoed markets.\n// 3. Wormhole <-> Sollet one-to-one swap markets.\n// 4. Wormhole <-> Native one-to-one swap markets.\n//\n\nfunction useRouteVerbose(fromMint, toMint) {\n  var _this = this;\n\n  var swapClient = useDexContext().swapClient;\n\n  var _a = (0, TokenList_1.useTokenListContext)(),\n      wormholeMap = _a.wormholeMap,\n      solletMap = _a.solletMap;\n\n  var asyncRoute = (0, react_async_hook_1.useAsync)(function () {\n    return __awaiter(_this, void 0, void 0, function () {\n      var swapMarket, wormholeMarket, kind_1, markets, kind;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , wormholeSwapMarket(swapClient.program.provider.connection, fromMint, toMint, wormholeMap, solletMap)];\n\n          case 1:\n            swapMarket = _a.sent();\n\n            if (swapMarket !== null) {\n              wormholeMarket = swapMarket[0], kind_1 = swapMarket[1];\n              return [2\n              /*return*/\n              , {\n                markets: [wormholeMarket],\n                kind: kind_1\n              }];\n            }\n\n            markets = swapClient.route(fromMint.equals(pubkeys_1.SOL_MINT) ? pubkeys_1.WRAPPED_GEMA_MINT : fromMint, toMint.equals(pubkeys_1.SOL_MINT) ? pubkeys_1.WRAPPED_GEMA_MINT : toMint);\n\n            if (markets === null) {\n              return [2\n              /*return*/\n              , null];\n            }\n\n            kind = \"usdx\";\n            return [2\n            /*return*/\n            , {\n              markets: markets,\n              kind: kind\n            }];\n        }\n      });\n    });\n  }, [fromMint, toMint, swapClient]);\n\n  if (asyncRoute.result) {\n    return asyncRoute.result;\n  }\n\n  return null;\n}\n\nexports.useRouteVerbose = useRouteVerbose; // Maps fromMint || toMint (in sort order) to swap market public key.\n// All markets for wormhole<->native tokens should be here, e.g.\n// USDC <-> wUSDC.\n\nvar WORMHOLE_NATIVE_MAP = new Map([[wormKey(pubkeys_1.WORM_USDC_MINT, pubkeys_1.USDC_MINT), pubkeys_1.WORM_USDC_MARKET], [wormKey(pubkeys_1.WORM_USDT_MINT, pubkeys_1.USDT_MINT), pubkeys_1.WORM_USDT_MARKET]]);\n\nfunction wormKey(fromMint, toMint) {\n  var _a = fromMint < toMint ? [fromMint, toMint] : [toMint, fromMint],\n      first = _a[0],\n      second = _a[1];\n\n  return first.toString() + second.toString();\n}\n\nfunction wormholeSwapMarket(conn, fromMint, toMint, wormholeMap, solletMap) {\n  return __awaiter(this, void 0, void 0, function () {\n    var market;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          market = wormholeNativeMarket(fromMint, toMint);\n\n          if (market !== null) {\n            return [2\n            /*return*/\n            , [market, \"wormhole-native\"]];\n          }\n\n          return [4\n          /*yield*/\n          , wormholeSolletMarket(conn, fromMint, toMint, wormholeMap, solletMap)];\n\n        case 1:\n          market = _a.sent();\n\n          if (market === null) {\n            return [2\n            /*return*/\n            , null];\n          }\n\n          return [2\n          /*return*/\n          , [market, \"wormhole-sollet\"]];\n      }\n    });\n  });\n}\n\nfunction wormholeNativeMarket(fromMint, toMint) {\n  var _a;\n\n  return (_a = WORMHOLE_NATIVE_MAP.get(wormKey(fromMint, toMint))) !== null && _a !== void 0 ? _a : null;\n} // Returns the market address of the 1-1 sollet<->wormhole swap market if it\n// exists. Otherwise, returns null.\n\n\nfunction wormholeSolletMarket(conn, fromMint, toMint, wormholeMap, solletMap) {\n  var _a;\n\n  return __awaiter(this, void 0, void 0, function () {\n    var fromWormhole, isFromWormhole, toWormhole, isToWormhole, fromSollet, isFromSollet, toSollet, isToSollet, base, _b, quote, wormholeInfo, solletInfo, market, marketExists;\n\n    return __generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          fromWormhole = wormholeMap.get(fromMint.toString());\n          isFromWormhole = fromWormhole !== undefined;\n          toWormhole = wormholeMap.get(toMint.toString());\n          isToWormhole = toWormhole !== undefined;\n          fromSollet = solletMap.get(fromMint.toString());\n          isFromSollet = fromSollet !== undefined;\n          toSollet = solletMap.get(toMint.toString());\n          isToSollet = toSollet !== undefined;\n          if (!((isFromWormhole || isToWormhole) && isFromWormhole !== isToWormhole)) return [3\n          /*break*/\n          , 4];\n          if (!((isFromSollet || isToSollet) && isFromSollet !== isToSollet)) return [3\n          /*break*/\n          , 4];\n          base = isFromSollet ? fromMint : toMint;\n          _b = isFromWormhole ? [fromMint, fromWormhole] : [toMint, toWormhole], quote = _b[0], wormholeInfo = _b[1];\n          return [4\n          /*yield*/\n          , (0, Sollet_1.fetchSolletInfo)(base)];\n\n        case 1:\n          solletInfo = _c.sent();\n\n          if (solletInfo.erc20Contract !== ((_a = wormholeInfo.extensions) === null || _a === void 0 ? void 0 : _a.address)) {\n            return [2\n            /*return*/\n            , null];\n          }\n\n          return [4\n          /*yield*/\n          , deriveWormholeMarket(base, quote)];\n\n        case 2:\n          market = _c.sent();\n\n          if (market === null) {\n            return [2\n            /*return*/\n            , null];\n          }\n\n          return [4\n          /*yield*/\n          , (0, Sollet_1.requestWormholeSwapMarketIfNeeded)(conn, base, quote, market, solletInfo)];\n\n        case 3:\n          marketExists = _c.sent();\n\n          if (!marketExists) {\n            return [2\n            /*return*/\n            , null];\n          }\n\n          return [2\n          /*return*/\n          , market];\n\n        case 4:\n          return [2\n          /*return*/\n          , null];\n      }\n    });\n  });\n} // Calculates the deterministic address for the sollet<->wormhole 1-1 swap\n// market.\n\n\nfunction deriveWormholeMarket(baseMint, quoteMint, version) {\n  if (version === void 0) {\n    version = 0;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var padToTwo, seed;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          if (version > 99) {\n            console.log(\"Swap market version cannot be greater than 99\");\n            return [2\n            /*return*/\n            , null];\n          }\n\n          if (version < 0) {\n            console.log(\"Version cannot be less than zero\");\n            return [2\n            /*return*/\n            , null];\n          }\n\n          padToTwo = function (n) {\n            return n <= 99 ? (\"0\" + n).slice(-2) : n;\n          };\n\n          seed = baseMint.toString().slice(0, 15) + quoteMint.toString().slice(0, 15) + padToTwo(version);\n          return [4\n          /*yield*/\n          , web3_js_1.PublicKey.createWithSeed(pubkeys_1.WORM_MARKET_BASE, seed, pubkeys_1.DEX_PID)];\n\n        case 1:\n          return [2\n          /*return*/\n          , _a.sent()];\n      }\n    });\n  });\n}\n\nvar _ORDERBOOK_CACHE = new Map();\n\nvar _MARKET_CACHE = new Map();","map":{"version":3,"sources":["/home/imentus/spl-token-wallet/node_modules/@project-serum/swap-ui/dist/context/Dex.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__createBinding","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","op","TypeError","pop","push","exports","useRouteVerbose","useRoute","useFairRoute","useBbo","useMarketName","useOrderbook","useMarket","useOpenOrders","useDexContext","DexContextProvider","FEE_MULTIPLIER","jsx_runtime_1","require","react_1","assert","react_async_hook_1","spl_token_1","web3_js_1","anchor","serum_1","pubkeys_1","TokenList_1","Sollet_1","Token_1","BASE_TAKER_FEE_BPS","_DexContext","default","createContext","props","_this","_a","useState","Map","ooAccounts","setOoAccounts","swapClient","closeOpenOrders","openOrder","newOoAccounts","openOrders","_b","market","toString","filter","oo","address","equals","set","delete","useEffect","program","provider","wallet","publicKey","OpenOrders","findForOwner","connection","DEX_PID","markets","multipleMarkets","marketClients","mintPubkeys","mints","mintInfos","Set","forEach","add","size","Error","utils","rpc","getMultipleAccounts","Array","from","values","map","PublicKey","programAccount","account","Market","getLayout","decode","data","opts","baseMintAddress","quoteMintAddress","flat","pk","mint","mintInfo","MintLayout","setMintCache","baseMintInfo","quoteMintInfo","ok","_baseSplTokenDecimals","decimals","_quoteSplTokenDecimals","_MARKET_CACHE","jsx","Provider","children","ctx","useContext","asyncMarket","useAsync","marketClient","load","refresh","setRefresh","asyncOrderbook","orderbook","_ORDERBOOK_CACHE","bids","asks","all","loadBids","loadAsks","listener","bidsAddress","onAccountChange","info","oldBestBid","newBestBid","Orderbook","items","price","r","removeAccountChangeListener","asksAddress","oldBestOffer","newBestOffer","tokenMap","useTokenMap","baseTicker","symbol","quoteTicker","name","bestBid","bestOffer","mid","fromMint","toMint","route","fromBbo","fromMarket","toBbo","WRAPPED_GEMA_MINT","SOL_MINT","useTokenListContext","wormholeMap","solletMap","asyncRoute","swapMarket","wormholeMarket","kind_1","kind","wormholeSwapMarket","WORMHOLE_NATIVE_MAP","wormKey","WORM_USDC_MINT","USDC_MINT","WORM_USDC_MARKET","WORM_USDT_MINT","USDT_MINT","WORM_USDT_MARKET","first","second","conn","wormholeNativeMarket","wormholeSolletMarket","fromWormhole","isFromWormhole","toWormhole","isToWormhole","fromSollet","isFromSollet","toSollet","isToSollet","base","quote","wormholeInfo","solletInfo","marketExists","_c","fetchSolletInfo","erc20Contract","extensions","deriveWormholeMarket","requestWormholeSwapMarketIfNeeded","baseMint","quoteMint","version","padToTwo","seed","console","log","slice","createWithSeed","WORM_MARKET_BASE"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useRouteVerbose = exports.useRoute = exports.useFairRoute = exports.useBbo = exports.useMarketName = exports.useOrderbook = exports.useMarket = exports.useOpenOrders = exports.useDexContext = exports.DexContextProvider = exports.FEE_MULTIPLIER = void 0;\nvar jsx_runtime_1 = require(\"react/jsx-runtime\");\nvar react_1 = __importStar(require(\"react\"));\nvar assert = __importStar(require(\"assert\"));\nvar react_async_hook_1 = require(\"react-async-hook\");\nvar spl_token_1 = require(\"@solana/spl-token\");\nvar web3_js_1 = require(\"@solana/web3.js\");\nvar anchor = __importStar(require(\"@project-serum/anchor\"));\nvar serum_1 = require(\"@project-serum/serum\");\nvar pubkeys_1 = require(\"../utils/pubkeys\");\nvar TokenList_1 = require(\"./TokenList\");\nvar Sollet_1 = require(\"./Sollet\");\nvar Token_1 = require(\"./Token\");\nvar BASE_TAKER_FEE_BPS = 0.0022;\nexports.FEE_MULTIPLIER = 1 - BASE_TAKER_FEE_BPS;\nvar _DexContext = react_1.default.createContext(null);\nfunction DexContextProvider(props) {\n    var _this = this;\n    var _a = (0, react_1.useState)(new Map()), ooAccounts = _a[0], setOoAccounts = _a[1];\n    var swapClient = props.swapClient;\n    // Removes the given open orders from the context.\n    var closeOpenOrders = function (openOrder) { return __awaiter(_this, void 0, void 0, function () {\n        var newOoAccounts, openOrders;\n        var _a;\n        return __generator(this, function (_b) {\n            newOoAccounts = new Map(ooAccounts);\n            openOrders = (_a = newOoAccounts\n                .get(openOrder.market.toString())) === null || _a === void 0 ? void 0 : _a.filter(function (oo) { return !oo.address.equals(openOrder.address); });\n            if (openOrders && openOrders.length > 0) {\n                newOoAccounts.set(openOrder.market.toString(), openOrders);\n            }\n            else {\n                newOoAccounts.delete(openOrder.market.toString());\n            }\n            setOoAccounts(newOoAccounts);\n            return [2 /*return*/];\n        });\n    }); };\n    // Three operations:\n    //\n    // 1. Fetch all open orders accounts for the connected wallet.\n    // 2. Batch fetch all market accounts for those open orders.\n    // 3. Batch fetch all mints associated with the markets.\n    (0, react_1.useEffect)(function () {\n        if (!swapClient.program.provider.wallet.publicKey) {\n            setOoAccounts(new Map());\n            return;\n        }\n        serum_1.OpenOrders.findForOwner(swapClient.program.provider.connection, swapClient.program.provider.wallet.publicKey, pubkeys_1.DEX_PID).then(function (openOrders) { return __awaiter(_this, void 0, void 0, function () {\n            var newOoAccounts, markets, multipleMarkets, marketClients, mintPubkeys, mints, mintInfos;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        newOoAccounts = new Map();\n                        markets = new Set();\n                        openOrders.forEach(function (oo) {\n                            markets.add(oo.market.toString());\n                            if (newOoAccounts.get(oo.market.toString())) {\n                                newOoAccounts.get(oo.market.toString()).push(oo);\n                            }\n                            else {\n                                newOoAccounts.set(oo.market.toString(), [oo]);\n                            }\n                        });\n                        if (markets.size > 100) {\n                            // Punt request chunking until there's user demand.\n                            throw new Error(\"Too many markets. Please file an issue to update this\");\n                        }\n                        return [4 /*yield*/, anchor.utils.rpc.getMultipleAccounts(swapClient.program.provider.connection, Array.from(markets.values()).map(function (m) { return new web3_js_1.PublicKey(m); }))];\n                    case 1:\n                        multipleMarkets = _a.sent();\n                        marketClients = multipleMarkets.map(function (programAccount) {\n                            return {\n                                publicKey: programAccount === null || programAccount === void 0 ? void 0 : programAccount.publicKey,\n                                account: new serum_1.Market(serum_1.Market.getLayout(pubkeys_1.DEX_PID).decode(programAccount === null || programAccount === void 0 ? void 0 : programAccount.account.data), -1, // Set below so that we can batch fetch mints.\n                                -1, // Set below so that we can batch fetch mints.\n                                swapClient.program.provider.opts, pubkeys_1.DEX_PID),\n                            };\n                        });\n                        setOoAccounts(newOoAccounts);\n                        mintPubkeys = Array.from(new Set(marketClients\n                            .map(function (m) { return [\n                            m.account.baseMintAddress.toString(),\n                            m.account.quoteMintAddress.toString(),\n                        ]; })\n                            .flat()).values()).map(function (pk) { return new web3_js_1.PublicKey(pk); });\n                        if (mintPubkeys.length > 100) {\n                            // Punt request chunking until there's user demand.\n                            throw new Error(\"Too many mints. Please file an issue to update this\");\n                        }\n                        return [4 /*yield*/, anchor.utils.rpc.getMultipleAccounts(swapClient.program.provider.connection, mintPubkeys)];\n                    case 2:\n                        mints = _a.sent();\n                        mintInfos = mints.map(function (mint) {\n                            var mintInfo = spl_token_1.MintLayout.decode(mint.account.data);\n                            (0, Token_1.setMintCache)(mint.publicKey, mintInfo);\n                            return { publicKey: mint.publicKey, mintInfo: mintInfo };\n                        });\n                        marketClients.forEach(function (m) {\n                            var baseMintInfo = mintInfos.filter(function (mint) {\n                                return mint.publicKey.equals(m.account.baseMintAddress);\n                            })[0];\n                            var quoteMintInfo = mintInfos.filter(function (mint) {\n                                return mint.publicKey.equals(m.account.quoteMintAddress);\n                            })[0];\n                            assert.ok(baseMintInfo && quoteMintInfo);\n                            // @ts-ignore\n                            m.account._baseSplTokenDecimals = baseMintInfo.mintInfo.decimals;\n                            // @ts-ignore\n                            m.account._quoteSplTokenDecimals = quoteMintInfo.mintInfo.decimals;\n                            _MARKET_CACHE.set(m.publicKey.toString(), new Promise(function (resolve) { return resolve(m.account); }));\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    }, [\n        swapClient.program.provider.connection,\n        swapClient.program.provider.wallet.publicKey,\n        swapClient.program.provider.opts,\n    ]);\n    return ((0, jsx_runtime_1.jsx)(_DexContext.Provider, __assign({ value: {\n            openOrders: ooAccounts,\n            closeOpenOrders: closeOpenOrders,\n            swapClient: swapClient,\n        } }, { children: props.children }), void 0));\n}\nexports.DexContextProvider = DexContextProvider;\nfunction useDexContext() {\n    var ctx = (0, react_1.useContext)(_DexContext);\n    if (ctx === null) {\n        throw new Error(\"Context not available\");\n    }\n    return ctx;\n}\nexports.useDexContext = useDexContext;\nfunction useOpenOrders() {\n    var ctx = useDexContext();\n    return ctx.openOrders;\n}\nexports.useOpenOrders = useOpenOrders;\n// Lazy load a given market.\nfunction useMarket(market) {\n    var _this = this;\n    var swapClient = useDexContext().swapClient;\n    var asyncMarket = (0, react_async_hook_1.useAsync)(function () { return __awaiter(_this, void 0, void 0, function () {\n        var marketClient;\n        var _this = this;\n        return __generator(this, function (_a) {\n            if (!market) {\n                return [2 /*return*/, undefined];\n            }\n            if (_MARKET_CACHE.get(market.toString())) {\n                return [2 /*return*/, _MARKET_CACHE.get(market.toString())];\n            }\n            marketClient = new Promise(function (resolve) { return __awaiter(_this, void 0, void 0, function () {\n                var marketClient;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, serum_1.Market.load(swapClient.program.provider.connection, market, swapClient.program.provider.opts, pubkeys_1.DEX_PID)];\n                        case 1:\n                            marketClient = _a.sent();\n                            resolve(marketClient);\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n            _MARKET_CACHE.set(market.toString(), marketClient);\n            return [2 /*return*/, marketClient];\n        });\n    }); }, [swapClient.program.provider.connection, market]);\n    if (asyncMarket.result) {\n        return asyncMarket.result;\n    }\n    return undefined;\n}\nexports.useMarket = useMarket;\n// Lazy load the orderbook for a given market.\nfunction useOrderbook(market) {\n    var _this = this;\n    var swapClient = useDexContext().swapClient;\n    var marketClient = useMarket(market);\n    var _a = (0, react_1.useState)(0), refresh = _a[0], setRefresh = _a[1];\n    var asyncOrderbook = (0, react_async_hook_1.useAsync)(function () { return __awaiter(_this, void 0, void 0, function () {\n        var orderbook;\n        var _this = this;\n        return __generator(this, function (_a) {\n            if (!market || !marketClient) {\n                return [2 /*return*/, undefined];\n            }\n            if (_ORDERBOOK_CACHE.get(market.toString())) {\n                return [2 /*return*/, _ORDERBOOK_CACHE.get(market.toString())];\n            }\n            orderbook = new Promise(function (resolve) { return __awaiter(_this, void 0, void 0, function () {\n                var _a, bids, asks;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0: return [4 /*yield*/, Promise.all([\n                                marketClient.loadBids(swapClient.program.provider.connection),\n                                marketClient.loadAsks(swapClient.program.provider.connection),\n                            ])];\n                        case 1:\n                            _a = _b.sent(), bids = _a[0], asks = _a[1];\n                            resolve({\n                                bids: bids,\n                                asks: asks,\n                            });\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n            _ORDERBOOK_CACHE.set(market.toString(), orderbook);\n            return [2 /*return*/, orderbook];\n        });\n    }); }, [refresh, swapClient.program.provider.connection, market, marketClient]);\n    // Stream in bids updates.\n    (0, react_1.useEffect)(function () {\n        var listener;\n        if (marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress) {\n            listener = swapClient.program.provider.connection.onAccountChange(marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress, function (info) { return __awaiter(_this, void 0, void 0, function () {\n                var bids, orderbook, oldBestBid, newBestBid;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            bids = serum_1.Orderbook.decode(marketClient, info.data);\n                            return [4 /*yield*/, _ORDERBOOK_CACHE.get(marketClient.address.toString())];\n                        case 1:\n                            orderbook = _a.sent();\n                            oldBestBid = orderbook === null || orderbook === void 0 ? void 0 : orderbook.bids.items(true).next().value;\n                            newBestBid = bids.items(true).next().value;\n                            if (orderbook &&\n                                oldBestBid &&\n                                newBestBid &&\n                                oldBestBid.price !== newBestBid.price) {\n                                orderbook.bids = bids;\n                                setRefresh(function (r) { return r + 1; });\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n        }\n        return function () {\n            if (listener) {\n                swapClient.program.provider.connection.removeAccountChangeListener(listener);\n            }\n        };\n    }, [\n        marketClient,\n        marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress,\n        swapClient.program.provider.connection,\n    ]);\n    // Stream in asks updates.\n    (0, react_1.useEffect)(function () {\n        var listener;\n        if (marketClient === null || marketClient === void 0 ? void 0 : marketClient.asksAddress) {\n            listener = swapClient.program.provider.connection.onAccountChange(marketClient === null || marketClient === void 0 ? void 0 : marketClient.asksAddress, function (info) { return __awaiter(_this, void 0, void 0, function () {\n                var asks, orderbook, oldBestOffer, newBestOffer;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            asks = serum_1.Orderbook.decode(marketClient, info.data);\n                            return [4 /*yield*/, _ORDERBOOK_CACHE.get(marketClient.address.toString())];\n                        case 1:\n                            orderbook = _a.sent();\n                            oldBestOffer = orderbook === null || orderbook === void 0 ? void 0 : orderbook.asks.items(false).next().value;\n                            newBestOffer = asks.items(false).next().value;\n                            if (orderbook &&\n                                oldBestOffer &&\n                                newBestOffer &&\n                                oldBestOffer.price !== newBestOffer.price) {\n                                orderbook.asks = asks;\n                                setRefresh(function (r) { return r + 1; });\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n        }\n        return function () {\n            if (listener) {\n                swapClient.program.provider.connection.removeAccountChangeListener(listener);\n            }\n        };\n    }, [\n        marketClient,\n        marketClient === null || marketClient === void 0 ? void 0 : marketClient.bidsAddress,\n        swapClient.program.provider.connection,\n    ]);\n    if (asyncOrderbook.result) {\n        return asyncOrderbook.result;\n    }\n    return undefined;\n}\nexports.useOrderbook = useOrderbook;\nfunction useMarketName(market) {\n    var _a, _b;\n    var tokenMap = (0, TokenList_1.useTokenMap)();\n    var marketClient = useMarket(market);\n    if (!marketClient) {\n        return null;\n    }\n    var baseTicker = marketClient\n        ? (_a = tokenMap.get(marketClient === null || marketClient === void 0 ? void 0 : marketClient.baseMintAddress.toString())) === null || _a === void 0 ? void 0 : _a.symbol\n        : \"-\";\n    var quoteTicker = marketClient\n        ? (_b = tokenMap.get(marketClient === null || marketClient === void 0 ? void 0 : marketClient.quoteMintAddress.toString())) === null || _b === void 0 ? void 0 : _b.symbol\n        : \"-\";\n    var name = baseTicker + \" / \" + quoteTicker;\n    return name;\n}\nexports.useMarketName = useMarketName;\n// Fair price for a given market, as defined by the mid.\nfunction useBbo(market) {\n    var orderbook = useOrderbook(market);\n    if (orderbook === undefined) {\n        return undefined;\n    }\n    var bestBid = orderbook.bids.items(true).next().value;\n    var bestOffer = orderbook.asks.items(false).next().value;\n    if (!bestBid && !bestOffer) {\n        return {};\n    }\n    if (!bestBid) {\n        return { bestOffer: bestOffer.price };\n    }\n    if (!bestOffer) {\n        return { bestBid: bestBid.price };\n    }\n    var mid = (bestBid.price + bestOffer.price) / 2.0;\n    return { bestBid: bestBid.price, bestOffer: bestOffer.price, mid: mid };\n}\nexports.useBbo = useBbo;\n// Fair price for a theoretical toMint/fromMint market. I.e., the number\n// of `fromMint` tokens to purchase a single `toMint` token. Aggregates\n// across a trade route, if needed.\nfunction useFairRoute(fromMint, toMint) {\n    var route = useRoute(fromMint, toMint);\n    var fromBbo = useBbo(route ? route[0] : undefined);\n    var fromMarket = useMarket(route ? route[0] : undefined);\n    var toBbo = useBbo(route ? route[1] : undefined);\n    if (route === null) {\n        return undefined;\n    }\n    if (route.length === 1 && fromBbo !== undefined) {\n        if (fromMarket === undefined) {\n            return undefined;\n        }\n        if ((fromMarket === null || fromMarket === void 0 ? void 0 : fromMarket.baseMintAddress.equals(fromMint)) ||\n            ((fromMarket === null || fromMarket === void 0 ? void 0 : fromMarket.baseMintAddress.equals(pubkeys_1.WRAPPED_GEMA_MINT)) &&\n                fromMint.equals(pubkeys_1.SOL_MINT))) {\n            return fromBbo.bestBid && 1.0 / fromBbo.bestBid;\n        }\n        else {\n            return fromBbo.bestOffer && fromBbo.bestOffer;\n        }\n    }\n    if (fromBbo === undefined ||\n        fromBbo.bestBid === undefined ||\n        toBbo === undefined ||\n        toBbo.bestOffer === undefined) {\n        return undefined;\n    }\n    return toBbo.bestOffer / fromBbo.bestBid;\n}\nexports.useFairRoute = useFairRoute;\nfunction useRoute(fromMint, toMint) {\n    var route = useRouteVerbose(fromMint, toMint);\n    if (route === null) {\n        return null;\n    }\n    return route.markets;\n}\nexports.useRoute = useRoute;\n// Types of routes.\n//\n// 1. Direct trades on USDC quoted markets.\n// 2. Transitive trades across two USDC qutoed markets.\n// 3. Wormhole <-> Sollet one-to-one swap markets.\n// 4. Wormhole <-> Native one-to-one swap markets.\n//\nfunction useRouteVerbose(fromMint, toMint) {\n    var _this = this;\n    var swapClient = useDexContext().swapClient;\n    var _a = (0, TokenList_1.useTokenListContext)(), wormholeMap = _a.wormholeMap, solletMap = _a.solletMap;\n    var asyncRoute = (0, react_async_hook_1.useAsync)(function () { return __awaiter(_this, void 0, void 0, function () {\n        var swapMarket, wormholeMarket, kind_1, markets, kind;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, wormholeSwapMarket(swapClient.program.provider.connection, fromMint, toMint, wormholeMap, solletMap)];\n                case 1:\n                    swapMarket = _a.sent();\n                    if (swapMarket !== null) {\n                        wormholeMarket = swapMarket[0], kind_1 = swapMarket[1];\n                        return [2 /*return*/, { markets: [wormholeMarket], kind: kind_1 }];\n                    }\n                    markets = swapClient.route(fromMint.equals(pubkeys_1.SOL_MINT) ? pubkeys_1.WRAPPED_GEMA_MINT : fromMint, toMint.equals(pubkeys_1.SOL_MINT) ? pubkeys_1.WRAPPED_GEMA_MINT : toMint);\n                    if (markets === null) {\n                        return [2 /*return*/, null];\n                    }\n                    kind = \"usdx\";\n                    return [2 /*return*/, { markets: markets, kind: kind }];\n            }\n        });\n    }); }, [fromMint, toMint, swapClient]);\n    if (asyncRoute.result) {\n        return asyncRoute.result;\n    }\n    return null;\n}\nexports.useRouteVerbose = useRouteVerbose;\n// Maps fromMint || toMint (in sort order) to swap market public key.\n// All markets for wormhole<->native tokens should be here, e.g.\n// USDC <-> wUSDC.\nvar WORMHOLE_NATIVE_MAP = new Map([\n    [wormKey(pubkeys_1.WORM_USDC_MINT, pubkeys_1.USDC_MINT), pubkeys_1.WORM_USDC_MARKET],\n    [wormKey(pubkeys_1.WORM_USDT_MINT, pubkeys_1.USDT_MINT), pubkeys_1.WORM_USDT_MARKET],\n]);\nfunction wormKey(fromMint, toMint) {\n    var _a = fromMint < toMint ? [fromMint, toMint] : [toMint, fromMint], first = _a[0], second = _a[1];\n    return first.toString() + second.toString();\n}\nfunction wormholeSwapMarket(conn, fromMint, toMint, wormholeMap, solletMap) {\n    return __awaiter(this, void 0, void 0, function () {\n        var market;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    market = wormholeNativeMarket(fromMint, toMint);\n                    if (market !== null) {\n                        return [2 /*return*/, [market, \"wormhole-native\"]];\n                    }\n                    return [4 /*yield*/, wormholeSolletMarket(conn, fromMint, toMint, wormholeMap, solletMap)];\n                case 1:\n                    market = _a.sent();\n                    if (market === null) {\n                        return [2 /*return*/, null];\n                    }\n                    return [2 /*return*/, [market, \"wormhole-sollet\"]];\n            }\n        });\n    });\n}\nfunction wormholeNativeMarket(fromMint, toMint) {\n    var _a;\n    return (_a = WORMHOLE_NATIVE_MAP.get(wormKey(fromMint, toMint))) !== null && _a !== void 0 ? _a : null;\n}\n// Returns the market address of the 1-1 sollet<->wormhole swap market if it\n// exists. Otherwise, returns null.\nfunction wormholeSolletMarket(conn, fromMint, toMint, wormholeMap, solletMap) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function () {\n        var fromWormhole, isFromWormhole, toWormhole, isToWormhole, fromSollet, isFromSollet, toSollet, isToSollet, base, _b, quote, wormholeInfo, solletInfo, market, marketExists;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    fromWormhole = wormholeMap.get(fromMint.toString());\n                    isFromWormhole = fromWormhole !== undefined;\n                    toWormhole = wormholeMap.get(toMint.toString());\n                    isToWormhole = toWormhole !== undefined;\n                    fromSollet = solletMap.get(fromMint.toString());\n                    isFromSollet = fromSollet !== undefined;\n                    toSollet = solletMap.get(toMint.toString());\n                    isToSollet = toSollet !== undefined;\n                    if (!((isFromWormhole || isToWormhole) && isFromWormhole !== isToWormhole)) return [3 /*break*/, 4];\n                    if (!((isFromSollet || isToSollet) && isFromSollet !== isToSollet)) return [3 /*break*/, 4];\n                    base = isFromSollet ? fromMint : toMint;\n                    _b = isFromWormhole\n                        ? [fromMint, fromWormhole]\n                        : [toMint, toWormhole], quote = _b[0], wormholeInfo = _b[1];\n                    return [4 /*yield*/, (0, Sollet_1.fetchSolletInfo)(base)];\n                case 1:\n                    solletInfo = _c.sent();\n                    if (solletInfo.erc20Contract !== ((_a = wormholeInfo.extensions) === null || _a === void 0 ? void 0 : _a.address)) {\n                        return [2 /*return*/, null];\n                    }\n                    return [4 /*yield*/, deriveWormholeMarket(base, quote)];\n                case 2:\n                    market = _c.sent();\n                    if (market === null) {\n                        return [2 /*return*/, null];\n                    }\n                    return [4 /*yield*/, (0, Sollet_1.requestWormholeSwapMarketIfNeeded)(conn, base, quote, market, solletInfo)];\n                case 3:\n                    marketExists = _c.sent();\n                    if (!marketExists) {\n                        return [2 /*return*/, null];\n                    }\n                    return [2 /*return*/, market];\n                case 4: return [2 /*return*/, null];\n            }\n        });\n    });\n}\n// Calculates the deterministic address for the sollet<->wormhole 1-1 swap\n// market.\nfunction deriveWormholeMarket(baseMint, quoteMint, version) {\n    if (version === void 0) { version = 0; }\n    return __awaiter(this, void 0, void 0, function () {\n        var padToTwo, seed;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (version > 99) {\n                        console.log(\"Swap market version cannot be greater than 99\");\n                        return [2 /*return*/, null];\n                    }\n                    if (version < 0) {\n                        console.log(\"Version cannot be less than zero\");\n                        return [2 /*return*/, null];\n                    }\n                    padToTwo = function (n) { return (n <= 99 ? (\"0\" + n).slice(-2) : n); };\n                    seed = baseMint.toString().slice(0, 15) +\n                        quoteMint.toString().slice(0, 15) +\n                        padToTwo(version);\n                    return [4 /*yield*/, web3_js_1.PublicKey.createWithSeed(pubkeys_1.WORM_MARKET_BASE, seed, pubkeys_1.DEX_PID)];\n                case 1: return [2 /*return*/, _a.sent()];\n            }\n        });\n    });\n}\nvar _ORDERBOOK_CACHE = new Map();\nvar _MARKET_CACHE = new Map();\n"]},"metadata":{},"sourceType":"script"}